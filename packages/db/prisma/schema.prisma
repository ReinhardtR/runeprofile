// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Account {
  accountHash BigInt      @id
  username    String      @unique
  accountType AccountType
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Skills
  attack       Int
  defence      Int
  strength     Int
  hitpoints    Int
  ranged       Int
  prayer       Int
  magic        Int
  cooking      Int
  woodcutting  Int
  fletching    Int
  fishing      Int
  firemaking   Int
  crafting     Int
  smithing     Int
  mining       Int
  herblore     Int
  agility      Int
  thieving     Int
  slayer       Int
  farming      Int
  runecraft    Int
  hunter       Int
  construction Int
  overall      Int

  // Model
  modelObj Bytes @db.LongBlob
  modelMtl Bytes @db.LongBlob

  // Collection Log
  CollectionLog CollectionLog?
}

model CollectionLog {
  Account     Account @relation(fields: [accountHash], references: [accountHash], onDelete: Cascade, onUpdate: Cascade)
  accountHash BigInt  @id

  totalObtained  Int
  totalItems     Int
  uniqueObtained Int
  uniqueItems    Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  KillCounts     KillCount[]
  CollectedItems CollectedItem[]
}

model KillCount {
  name      String
  amount    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  CollectionLog CollectionLog @relation(fields: [accountHash], references: [accountHash], onDelete: Cascade, onUpdate: Cascade)
  accountHash   BigInt

  ItemSource     ItemSource @relation(fields: [itemSourceName], references: [name], onDelete: Cascade, onUpdate: Cascade)
  itemSourceName String

  @@id(name: "killCountId", [accountHash, name])
}

model CollectedItem {
  quantity  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  CollectionLog CollectionLog @relation(fields: [accountHash], references: [accountHash], onDelete: Cascade, onUpdate: Cascade)
  accountHash   BigInt

  Item   Item @relation(fields: [itemId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  itemId Int

  @@id(name: "collectedItemId", [accountHash, itemId])
}

model ItemSource {
  name      String   @id
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  KillCounts KillCount[]
  Items      Item[]
}

model Item {
  id        Int      @id
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  CollectedItems CollectedItem[]
  ItemSources    ItemSource[]
}

enum AccountType {
  NORMAL
  IRONMAN
  HARDCORE_IRONMAN
  ULTIMATE_IRONMAN
  GROUP_IRONMAN
  HARDCORE_GROUP_IRONMAN
}
